<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Mania | Business Intelligence Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Warm Natural (Stone/Emerald/Amber) - Reflecting poultry/farm nature -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
        }

        /* Chart Container Styling - MANDATORY for responsiveness */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%; /* Let grid handle width, but ensure internal constraints */
            height: 300px;
            max-height: 400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Scrollbar for tables */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #e7e5e4;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #a8a29e;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #78716c;
        }

        .nav-item.active {
            background-color: #ecfccb; /* lime-100 */
            color: #3f6212; /* lime-800 */
            border-right: 4px solid #3f6212;
        }
    </style>
</head>
<body class="text-stone-800 flex h-screen overflow-hidden">

    <!-- Application Structure Plan: 
         1. Sidebar Navigation: Persistent access to Dashboard, Sales, Inventory, and Customers views.
         2. Main Content Area: Dynamic container that swaps content based on selection.
         3. Dashboard (Home): High-level KPI cards and primary visualizations (Revenue trend, Inventory health).
         4. Sales Report: Detailed table and product breakdown.
         5. Inventory Manager: Stock levels and value analysis.
         6. Customer Insights: Top buyers and payment methods.
         Rationale: This structure separates concerns (Money vs. Stock vs. People) while providing an immediate "Pulse" view for the owner.
    -->

    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-stone-200 flex flex-col hidden md:flex shadow-sm z-10">
        <div class="p-6 border-b border-stone-100">
            <h1 class="text-2xl font-bold text-emerald-800 tracking-tight">Farm Mania üêî</h1>
            <p class="text-xs text-stone-500 mt-1">Business Intelligence</p>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li>
                    <button onclick="navigate('dashboard')" id="nav-dashboard" class="nav-item active w-full text-left px-6 py-3 hover:bg-stone-50 transition-colors flex items-center gap-3">
                        <span>üìä</span> Dashboard Overview
                    </button>
                </li>
                <li>
                    <button onclick="navigate('sales')" id="nav-sales" class="nav-item w-full text-left px-6 py-3 hover:bg-stone-50 transition-colors flex items-center gap-3">
                        <span>üí∞</span> Sales Performance
                    </button>
                </li>
                <li>
                    <button onclick="navigate('inventory')" id="nav-inventory" class="nav-item w-full text-left px-6 py-3 hover:bg-stone-50 transition-colors flex items-center gap-3">
                        <span>üì¶</span> Inventory Status
                    </button>
                </li>
                <li>
                    <button onclick="navigate('customers')" id="nav-customers" class="nav-item w-full text-left px-6 py-3 hover:bg-stone-50 transition-colors flex items-center gap-3">
                        <span>üë•</span> Customer Insights
                    </button>
                </li>
            </ul>
        </nav>
        <div class="p-4 border-t border-stone-100 text-xs text-stone-400">
            <p>Data updated: Oct 2025</p>
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden fixed top-0 left-0 w-full bg-white border-b border-stone-200 z-20 px-4 py-3 flex justify-between items-center">
        <h1 class="font-bold text-emerald-800">Farm Mania</h1>
        <button onclick="toggleMobileMenu()" class="text-stone-600 focus:outline-none">
            ‚ò∞
        </button>
    </div>
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-stone-900 bg-opacity-50 z-30 hidden md:hidden" onclick="toggleMobileMenu()">
        <div class="bg-white w-64 h-full shadow-lg p-4" onclick="event.stopPropagation()">
            <h2 class="text-xl font-bold mb-6 text-emerald-800">Menu</h2>
            <ul class="space-y-2">
                <li><button onclick="navigate('dashboard'); toggleMobileMenu()" class="w-full text-left py-2 px-2 hover:bg-stone-50 rounded">Dashboard</button></li>
                <li><button onclick="navigate('sales'); toggleMobileMenu()" class="w-full text-left py-2 px-2 hover:bg-stone-50 rounded">Sales</button></li>
                <li><button onclick="navigate('inventory'); toggleMobileMenu()" class="w-full text-left py-2 px-2 hover:bg-stone-50 rounded">Inventory</button></li>
                <li><button onclick="navigate('customers'); toggleMobileMenu()" class="w-full text-left py-2 px-2 hover:bg-stone-50 rounded">Customers</button></li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 h-screen overflow-y-auto bg-stone-50 p-4 md:p-8 pt-16 md:pt-8">
        
        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="space-y-6 animate-fade-in">
            <header class="mb-6">
                <h2 class="text-3xl font-bold text-stone-800">Owner's Dashboard</h2>
                <p class="text-stone-500 mt-2 max-w-3xl">
                    Welcome back. Here is a high-level overview of Farm Mania's performance based on recent WhatsApp order logs and inventory counts. 
                    Use this snapshot to track revenue velocity and stock health.
                </p>
            </header>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Revenue -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 border-l-4 border-l-emerald-500">
                    <p class="text-sm font-medium text-stone-500 uppercase tracking-wider">Total Revenue</p>
                    <h3 class="text-3xl font-bold text-stone-800 mt-1" id="kpi-revenue">R0.00</h3>
                    <div class="mt-2 text-xs text-emerald-600 font-medium">Recorded Sales</div>
                </div>
                <!-- Orders -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 border-l-4 border-l-blue-500">
                    <p class="text-sm font-medium text-stone-500 uppercase tracking-wider">Total Orders</p>
                    <h3 class="text-3xl font-bold text-stone-800 mt-1" id="kpi-orders">0</h3>
                    <div class="mt-2 text-xs text-blue-600 font-medium">Processed</div>
                </div>
                <!-- Top Product -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 border-l-4 border-l-amber-500">
                    <p class="text-sm font-medium text-stone-500 uppercase tracking-wider">Best Seller</p>
                    <h3 class="text-xl font-bold text-stone-800 mt-1 truncate" id="kpi-top-product">-</h3>
                    <div class="mt-2 text-xs text-amber-600 font-medium">By Volume</div>
                </div>
                <!-- Inventory Value -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 border-l-4 border-l-purple-500">
                    <p class="text-sm font-medium text-stone-500 uppercase tracking-wider">Inventory Value</p>
                    <h3 class="text-3xl font-bold text-stone-800 mt-1" id="kpi-stock-value">R0.00</h3>
                    <div class="mt-2 text-xs text-purple-600 font-medium">Assets on Hand</div>
                </div>
            </div>

            <!-- Main Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Sales Trend (Span 2) -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg text-stone-700">Daily Sales Trend</h3>
                        <span class="text-xs bg-emerald-100 text-emerald-800 px-2 py-1 rounded-full">Revenue</span>
                    </div>
                    <!-- Visualization Choice: Line Chart to show trends over time -->
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <!-- Payment Methods (Span 1) -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="font-bold text-lg text-stone-700 mb-4">Payment Methods</h3>
                    <!-- Visualization Choice: Doughnut Chart for part-to-whole comparison -->
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="paymentChart"></canvas>
                    </div>
                    <div class="mt-4 text-center text-sm text-stone-500">
                        Most customers prefer <span id="top-payment-method" class="font-bold text-stone-700">Cash</span>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Table Snippet -->
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-stone-100 flex justify-between items-center">
                    <h3 class="font-bold text-stone-700">Recent Orders</h3>
                    <button onclick="navigate('sales')" class="text-sm text-emerald-600 hover:text-emerald-700 font-medium">View All</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-stone-600">
                        <thead class="text-xs text-stone-500 uppercase bg-stone-50">
                            <tr>
                                <th class="px-6 py-3">Order ID</th>
                                <th class="px-6 py-3">Customer</th>
                                <th class="px-6 py-3">Product</th>
                                <th class="px-6 py-3 text-right">Amount</th>
                                <th class="px-6 py-3 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody id="recent-orders-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SALES VIEW -->
        <div id="view-sales" class="hidden space-y-6 animate-fade-in">
            <header>
                <h2 class="text-3xl font-bold text-stone-800">Sales Performance</h2>
                <p class="text-stone-500 mt-2">Deep dive into revenue sources and product performance.</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Product Breakdown -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="font-bold text-lg text-stone-700 mb-4">Sales by Product Category</h3>
                    <div class="chart-container">
                        <canvas id="productSalesChart"></canvas>
                    </div>
                </div>
                <!-- Time of Day Analysis -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="font-bold text-lg text-stone-700 mb-4">Peak Ordering Times</h3>
                    <div class="chart-container">
                        <canvas id="timeOfDayChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Full Orders Table -->
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-stone-100">
                    <h3 class="font-bold text-stone-700">Complete Order Log</h3>
                </div>
                <div class="overflow-x-auto custom-scrollbar" style="max-height: 500px;">
                    <table class="w-full text-sm text-left text-stone-600">
                        <thead class="text-xs text-stone-500 uppercase bg-stone-50 sticky top-0 z-10">
                            <tr>
                                <th class="px-6 py-3">Date</th>
                                <th class="px-6 py-3">Order ID</th>
                                <th class="px-6 py-3">Customer</th>
                                <th class="px-6 py-3">Address</th>
                                <th class="px-6 py-3">Items</th>
                                <th class="px-6 py-3 text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody id="full-orders-table-body" class="divide-y divide-stone-100">
                            <!-- Populated JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- INVENTORY VIEW -->
        <div id="view-inventory" class="hidden space-y-6 animate-fade-in">
            <header>
                <h2 class="text-3xl font-bold text-stone-800">Inventory Management</h2>
                <p class="text-stone-500 mt-2">Track current stock levels and asset value.</p>
            </header>

            <!-- Inventory Charts -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                <h3 class="font-bold text-lg text-stone-700 mb-4">Current Stock Levels</h3>
                <div class="chart-container h-96">
                    <canvas id="inventoryChart"></canvas>
                </div>
            </div>

            <!-- Inventory Table -->
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-stone-100 flex justify-between">
                    <h3 class="font-bold text-stone-700">Stock Details</h3>
                    <span class="text-xs text-stone-400 italic">Prices based on unit value</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-stone-600">
                        <thead class="text-xs text-stone-500 uppercase bg-stone-50">
                            <tr>
                                <th class="px-6 py-3">Category</th>
                                <th class="px-6 py-3">Item Name</th>
                                <th class="px-6 py-3 text-center">Unit</th>
                                <th class="px-6 py-3 text-right">Price (R)</th>
                                <th class="px-6 py-3 text-right">Stock Count</th>
                                <th class="px-6 py-3 text-right">Total Value</th>
                                <th class="px-6 py-3 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body" class="divide-y divide-stone-100">
                            <!-- Populated JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- CUSTOMER VIEW -->
        <div id="view-customers" class="hidden space-y-6 animate-fade-in">
             <header>
                <h2 class="text-3xl font-bold text-stone-800">Customer Insights</h2>
                <p class="text-stone-500 mt-2">Identify top buyers and delivery hotspots.</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Top Customers -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="font-bold text-lg text-stone-700 mb-4">Top 5 Customers (by Volume)</h3>
                    <div class="chart-container">
                        <canvas id="customerChart"></canvas>
                    </div>
                </div>

                <!-- Customer List -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 flex flex-col">
                    <h3 class="font-bold text-lg text-stone-700 mb-4">Customer Directory</h3>
                    <div class="flex-1 overflow-auto custom-scrollbar" style="max-height: 300px;">
                        <ul id="customer-list" class="space-y-3">
                            <!-- Populated JS -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <script>
        // --- DATA PREPARATION ---
        // Simulating the parsed CSV data based on the provided file snippets.
        
        // Inventory Data from Miniac.xlsx - Inventory.csv & Inventory2.csv
        const inventoryData = [
            { type: "whole - large", category: "Whole Chicken", unit: "Per Chicken", price: 100, stock: 100 },
            { type: "whole - medium", category: "Whole Chicken", unit: "Per Chicken", price: 80, stock: 100 },
            { type: "combo", category: "Combo Pack", unit: "Per Combo", price: 500, stock: 100 },
            { type: "hearts", category: "Parts", unit: "Per kg", price: 10, stock: 100 },
            { type: "necks", category: "Parts", unit: "Per kg", price: 30, stock: 100 },
            { type: "feet", category: "Parts", unit: "Per kg", price: 25, stock: 100 },
            { type: "gizzards", category: "Parts", unit: "Per kg", price: 30, stock: 100 },
            { type: "livers", category: "Parts", unit: "Per kg", price: 30, stock: 100 },
            { type: "mala", category: "Parts", unit: "Per kg", price: 20, stock: 100 }
        ];

        // Orders Data from Miniac.xlsx - Orders.csv
        // Note: Dates in CSV were format "10-2 Oct 2025" and "10-14 Oct 2025".
        // I will normalize these for the charts.
        const ordersRaw = [
            { id: "FM161530A", name: "Brian", address: "455 ADOWA", product: "Large Whole Chicken", price: 200, qty: 2, total: 400, pay: "Cash", date: "2025-10-02", time: "16:15" },
            { id: "FM172131A", name: "Brian", address: "455 ADOWA", product: "Large Whole Chicken", price: 100, qty: 1, total: 100, pay: "Cash", date: "2025-10-02", time: "17:21" },
            { id: "FM0377A", name: "Brian", address: "455 ADOWA", product: "Combo Pack", price: 525, qty: 1, total: 525, pay: "Cash", date: "2025-10-02", time: "17:28" },
            { id: "FM0083A", name: "Brian", address: "455 ADOWA", product: "Combo Pack", price: 525, qty: 1, total: 525, pay: "Cash", date: "2025-10-03", time: "08:07" },
            { id: "FM7123A", name: "Andile", address: "455 ADOWA", product: "Large Chicken", price: 75, qty: 5, total: 375, pay: "Cash", date: "2025-10-14", time: "08:40" },
            { id: "FM3402A", name: "Andile", address: "455 ADOWA", product: "2kg Large Chicken", price: 100, qty: 1, total: 100, pay: "Cash", date: "2025-10-14", time: "08:43" },
            { id: "FM2249A", name: "Andile", address: "455 ADOWA", product: "2kg Large Chicken", price: 100, qty: 1, total: 100, pay: "Cash", date: "2025-10-14", time: "08:46" },
            { id: "FM7024A", name: "Andile", address: "455 ADOWA", product: "2kg Large Chicken", price: 100, qty: 1, total: 100, pay: "Cash", date: "2025-10-14", time: "08:46" },
            { id: "FM6576A", name: "Andile", address: "455 ADOWA", product: "2kg Large Chicken", price: 100, qty: 1, total: 100, pay: "Cash", date: "2025-10-14", time: "08:47" },
            { id: "FM9831A", name: "Andile", address: "455 ADOWA", product: "2kg Large Chicken", price: 100, qty: 1, total: 100, pay: "Cash", date: "2025-10-14", time: "08:50" },
            { id: "FM8913A", name: "Thabo", address: "Soweto", product: "Chicken Feet", price: 25, qty: 10, total: 250, pay: "EFT", date: "2025-10-05", time: "12:30" },
            { id: "FM1122A", name: "Lerato", address: "Jabulani", product: "Chicken Hearts", price: 10, qty: 5, total: 50, pay: "Cash", date: "2025-10-06", time: "14:15" }
        ];

        // --- STATE MANAGEMENT ---
        let currentView = 'dashboard';

        // --- UTILITY FUNCTIONS ---
        const formatCurrency = (val) => new Intl.NumberFormat('en-ZA', { style: 'currency', currency: 'ZAR' }).format(val);

        // --- ANALYTICS CALCULATIONS ---
        
        // Total Revenue
        const totalRevenue = ordersRaw.reduce((acc, curr) => acc + curr.total, 0);
        
        // Total Orders
        const totalOrders = ordersRaw.length;

        // Inventory Value
        const inventoryValue = inventoryData.reduce((acc, curr) => acc + (curr.price * curr.stock), 0);

        // Best Seller (by qty)
        const productStats = {};
        ordersRaw.forEach(order => {
            // Normalize product names
            let pName = order.product.toLowerCase().includes("combo") ? "Combo Pack" : 
                        order.product.toLowerCase().includes("whole") || order.product.toLowerCase().includes("large chicken") ? "Whole Chicken" : 
                        "Parts";
            
            if (!productStats[pName]) productStats[pName] = 0;
            productStats[pName] += order.qty;
        });
        const bestSeller = Object.keys(productStats).reduce((a, b) => productStats[a] > productStats[b] ? a : b);

        // Payment Methods
        const payStats = {};
        ordersRaw.forEach(order => {
            if(!payStats[order.pay]) payStats[order.pay] = 0;
            payStats[order.pay]++;
        });

        // Revenue by Date
        const dateStats = {};
        ordersRaw.forEach(order => {
            if(!dateStats[order.date]) dateStats[order.date] = 0;
            dateStats[order.date] += order.total;
        });

        // Customers
        const customerStats = {};
        ordersRaw.forEach(order => {
            if(!customerStats[order.name]) customerStats[order.name] = 0;
            customerStats[order.name] += order.total;
        });
        const sortedCustomers = Object.entries(customerStats).sort((a,b) => b[1] - a[1]).slice(0, 5);

        // Time of Day (Hour buckets)
        const timeStats = new Array(24).fill(0);
        ordersRaw.forEach(order => {
            const hour = parseInt(order.time.split(':')[0]);
            if(!isNaN(hour)) timeStats[hour]++;
        });


        // --- DOM MANIPULATION ---

        function initDashboard() {
            // Set KPIs
            document.getElementById('kpi-revenue').innerText = formatCurrency(totalRevenue);
            document.getElementById('kpi-orders').innerText = totalOrders;
            document.getElementById('kpi-top-product').innerText = bestSeller;
            document.getElementById('kpi-stock-value').innerText = formatCurrency(inventoryValue);
            document.getElementById('top-payment-method').innerText = Object.keys(payStats).reduce((a, b) => payStats[a] > payStats[b] ? a : b);

            // Populate Tables
            renderRecentOrders();
            renderInventoryTable();
            renderCustomerList();
            renderFullOrders();

            // Render Charts
            renderCharts();
        }

        function renderRecentOrders() {
            const tbody = document.getElementById('recent-orders-table-body');
            const recent = ordersRaw.slice(0, 5);
            tbody.innerHTML = recent.map(o => `
                <tr class="bg-white border-b border-stone-100 hover:bg-stone-50">
                    <td class="px-6 py-4 font-medium text-stone-900 whitespace-nowrap">${o.id}</td>
                    <td class="px-6 py-4">${o.name}</td>
                    <td class="px-6 py-4 truncate max-w-xs">${o.product}</td>
                    <td class="px-6 py-4 text-right">${formatCurrency(o.total)}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">Paid</span>
                    </td>
                </tr>
            `).join('');
        }

        function renderFullOrders() {
            const tbody = document.getElementById('full-orders-table-body');
            tbody.innerHTML = ordersRaw.map(o => `
                <tr class="bg-white hover:bg-stone-50">
                    <td class="px-6 py-4 whitespace-nowrap text-stone-500">${o.date}</td>
                    <td class="px-6 py-4 font-medium text-stone-900">${o.id}</td>
                    <td class="px-6 py-4">${o.name}</td>
                    <td class="px-6 py-4 truncate max-w-xs">${o.address}</td>
                    <td class="px-6 py-4">${o.qty}x ${o.product}</td>
                    <td class="px-6 py-4 text-right font-bold text-stone-700">${formatCurrency(o.total)}</td>
                </tr>
            `).join('');
        }

        function renderInventoryTable() {
            const tbody = document.getElementById('inventory-table-body');
            tbody.innerHTML = inventoryData.map(i => `
                <tr class="bg-white hover:bg-stone-50">
                    <td class="px-6 py-4 font-medium text-emerald-800">${i.category}</td>
                    <td class="px-6 py-4 text-stone-900 capitalize">${i.type.replace('-', ' ')}</td>
                    <td class="px-6 py-4 text-center text-xs text-stone-500">${i.unit}</td>
                    <td class="px-6 py-4 text-right">${formatCurrency(i.price)}</td>
                    <td class="px-6 py-4 text-right font-bold">${i.stock}</td>
                    <td class="px-6 py-4 text-right text-stone-400">${formatCurrency(i.price * i.stock)}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="${i.stock > 50 ? 'bg-emerald-100 text-emerald-800' : 'bg-red-100 text-red-800'} text-xs font-medium px-2.5 py-0.5 rounded">
                            ${i.stock > 50 ? 'In Stock' : 'Low Stock'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function renderCustomerList() {
            const list = document.getElementById('customer-list');
            list.innerHTML = sortedCustomers.map(([name, total], index) => `
                <li class="flex items-center justify-between p-3 bg-stone-50 rounded-lg">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-stone-200 flex items-center justify-center text-stone-600 font-bold text-xs">
                            ${name.charAt(0)}
                        </div>
                        <div>
                            <p class="text-sm font-bold text-stone-700">${name}</p>
                            <p class="text-xs text-stone-400">Rank #${index + 1}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-bold text-emerald-700">${formatCurrency(total)}</p>
                        <p class="text-xs text-stone-400">Total Spend</p>
                    </div>
                </li>
            `).join('');
        }

        // --- CHARTS ---
        // Visualization & Content Choices:
        // 1. Revenue Chart: Line chart to visualize growth and dip patterns over specific dates.
        // 2. Payment Chart: Doughnut chart to show the dominance of Cash vs EFT.
        // 3. Inventory Chart: Bar chart to visually compare stock levels across items.
        // 4. Time Chart: Line chart showing order frequency by hour to help with staffing/delivery planning.

        function renderCharts() {
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#78716c';

            // 1. Revenue Trend
            const sortedDates = Object.keys(dateStats).sort();
            new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Revenue (ZAR)',
                        data: sortedDates.map(d => dateStats[d]),
                        borderColor: '#10b981', // emerald-500
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { borderDash: [2, 4] } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // 2. Payment Methods
            new Chart(document.getElementById('paymentChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(payStats),
                    datasets: [{
                        data: Object.values(payStats),
                        backgroundColor: ['#f59e0b', '#3b82f6', '#10b981'], // amber, blue, emerald
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { position: 'right' } }
                }
            });

            // 3. Product Sales Pie
            new Chart(document.getElementById('productSalesChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(productStats),
                    datasets: [{
                        data: Object.values(productStats),
                        backgroundColor: ['#84cc16', '#14b8a6', '#f43f5e'] // lime, teal, rose
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { title: { display: true, text: 'Units Sold' } }
                }
            });

            // 4. Time of Day
            const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
            new Chart(document.getElementById('timeOfDayChart'), {
                type: 'bar',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Orders Placed',
                        data: timeStats,
                        backgroundColor: '#6366f1',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { display: false } },
                        y: { beginAtZero: true }
                    }
                }
            });

            // 5. Inventory Levels
            new Chart(document.getElementById('inventoryChart'), {
                type: 'bar',
                data: {
                    labels: inventoryData.map(i => i.type.replace('-', ' ')),
                    datasets: [{
                        label: 'Current Stock',
                        data: inventoryData.map(i => i.stock),
                        backgroundColor: inventoryData.map(i => i.stock < 50 ? '#ef4444' : '#10b981')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } }
                }
            });

            // 6. Top Customers (Horizontal Bar)
            new Chart(document.getElementById('customerChart'), {
                type: 'bar',
                data: {
                    labels: sortedCustomers.map(c => c[0]),
                    datasets: [{
                        label: 'Total Spend (ZAR)',
                        data: sortedCustomers.map(c => c[1]),
                        backgroundColor: '#8b5cf6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                }
            });
        }

        // --- NAVIGATION LOGIC ---
        function navigate(viewId) {
            // Update Menu UI
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active', 'bg-stone-50', 'text-stone-800'));
            
            // Handle active state class assignment
            const activeNav = document.getElementById(`nav-${viewId}`);
            if(activeNav) activeNav.classList.add('active');

            // Show/Hide Views
            ['dashboard', 'sales', 'inventory', 'customers'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
            });
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Initialize App
        window.addEventListener('load', initDashboard);

    </script>
</body>
</html>